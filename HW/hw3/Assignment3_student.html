<!DOCTYPE html>
<html>
    <head>
        <title>Charts using react</title>
        <!--import the libraries needed-->
        <link rel="stylesheet" href="styles.css">
        <script src="https://d3js.org/d3.v6.min.js"></script>
        <script src="https://d3js.org/d3-path.v2.min.js"></script>
        <script src="https://d3js.org/d3-shape.v2.min.js"></script>
        <script crossingin src="https://unpkg.com/react/umd/react.development.js"></script>
        <script crossingin src="https://unpkg.com/react-dom/umd/react-dom.development.js"></script>
        <script crossingin src="https://unpkg.com/babel-standalone/babel.js"></script>
    </head>
        
    <body>
        <!--some necessary html tags-->
        <h1>Let's make some charts.</h1>
        <div id="root"></div>
        <script type='text/babel'>
            const margin = { top: 20, right: 20, bottom: 180, left: 40, gap: 50 };
            const csvUrl = 'https://gist.githubusercontent.com/hogwild/3b9aa737bde61dcb4dfa60cde8046e04/raw/citibike2020.csv'
            function useData(csvPath){
                const [dataAll, setData] = React.useState(null);
                React.useEffect(() => {
                    d3.csv(csvPath).then(data => {
                        data.forEach(d => {
                            d.start = +d.start;
                            d.tripdurationS = +d.tripdurationS;
                            d.end = +d.end;
                            d.tripdurationE = +d.tripdurationE;
                        });
                        setData(data);
                    });
                }, []);
                return dataAll;
            }

            /**
             * Note: 
             * After you finish task 2, this components should return either 
             * the Y Axis for the scatter plot or the Y Axis for the bar chart,
             * depending on the its props.
             */
            function YAxes(props) {
                const {yScale, height} = props;
                const ticks = yScale.ticks();
                return <g>
                    <line y2 = {height} stroke = {`black`} />
                    {ticks.map( tickValue => {
                        return <g key = {tickValue} transform = {`translate(-10, ${yScale(tickValue)})`}>
                                <line x2 = {10} stroke = {"black"} />
                                <text style = {{textAnchor: 'end', fontSize: '18px'}}>
                                {tickValue}
                                </text>
                                </g> })}

                    

                </g>
            }
               
            

            /**
             * Note: 
             * After you finish task 2, this components should return either 
             * the X Axis for the scatter plot or the X Axis for the bar chart,
             * depending on the its props.
             */
            function XAxes(props) {
                const {xScale, width, height} = props;
                const ticks = xScale.ticks();
                return <g>
                    <line x1 = {0} y1={height} x2={width} y2 ={height} stroke = {`black`} />
                    {ticks.map( tickValue => {
                        return <g key = {tickValue} transform = {`translate(${xScale(tickValue)}, ${height})`}>

                                <line y2 = {5} stroke = {"black"} />
                                <text style = {{textAnchor: 'middle', fontSize: '18px'}} y ={20}>
                                {tickValue}
                                </text>
                                </g> })}

                    

                </g>
                
            }

            function Points(props) {
                // console.log(data)
                const {data, xScale, yScale, radius, color} = props;
                return <g> 
                    {data.map(d => {
                        return <circle key = {d.station} cx={xScale(d.tripdurationS)}
                        cy = {yScale(d.tripdurationE)} r = {radius} fill = {color} stroke = {`black`} fill={"steelblue"} />


                    })}
                    
                </g>
                 
            }

            function ScatterPlot(props) {
                // const data = useData(csvUrl);
                // console.log(data);
                // if (!data) {
                //    return <pre>Loading...</pre>;
                // };
                //console.log(props, 111);
                const data = props.data;
                const height = height - margin.top - margin.bottom;
                const width = width - margin.left - margin.right;
                const xScale = d3.scaleLinear().range([0, width])
                    .domain([0, d3.max(data, d=> d.tripdurationS)]).nice();
                    const yScale = d3.scaleLinear().range([height, 0])
                    .domain([0, d3.max(data, d=> d.tripdurationE)]).nice();
                return <g transform = {`translate(${margin.left}, ${margin.top})`}>
                    <Points data = {data} xScale = {xScale} yScale = {yScale} radius = {5} color = {"steelblue"}/>
                    <YAxes />    
                    <XAxes />
                </g>
            };

            function Bars(props) {
                
            }

            function BarChart(props) {
                return <g></g>
            }

            function Tooltip(props) {
               
            }

            const Charts = () => {
                const dataAll = useData(csvUrl);
                console.log(dataAll, 135);
                if (!dataAll) {
                   return <pre>Loading...</pre>;
                };
                console.log(dataAll, 138);
                const WIDTH = 600;
                const HEIGHT = 800;
                const innerHeight = HEIGHT - margin.top - margin.bottom;
                const innerWidth = WIDTH - margin.left - margin.right; 
                const data = dataAll.filter( d => { 
                    return d.month === "May"; 
                });
                return (
                    <div>
                        <div>
                            <input key="slider" type='range' min='0' max='11' value={4} step='1' 
                            onChange={()=>{console.log("In Task 5, you need to define a handler.")}}/>
                            <input key="monthText" type="text" value={"May"} readOnly/>
                        </div>
                        <svg width={WIDTH} height={HEIGHT}>
                            <ScatterPlot data = {data}/>
                            <BarChart />
                        </svg>
                    </div>
                )   
            }
           const rootElement = document.getElementById('root');
           ReactDOM.render(<Charts />, rootElement);
        </script> 
    </body>
</html>